{"name":"Dropbox Backup","tagline":"Dropbox Backup is a collection of BASH scripts for backing up your server with Dropbox Uploader.","body":"# Dropbox Backup\r\n\r\n`Dropbox Backup` is a collection of **BASH** scripts for backing up your server with [Dropbox Uploader](https://github.com/andreafabrizi/Dropbox-Uploader/).\r\n\r\n## Setup\r\n\r\n1: First clone this repo:\r\n```bash\r\n$ cd ~\r\n$ git clone https://github.com/ClickBeyond/DropboxBackup.git\r\n```\r\n\r\n2: Then give the scripts execution permissions if they don't already have them:\r\n```bash\r\n$ cd ~/DropBoxBackup\r\n$ chmod +x dropbox_uploader.sh\r\n$ chmod +x db_backup.sh\r\n$ chmod +x log_backup.sh\r\n$ chmod +x web_cron.sh\r\n```\r\n\r\n3: Finally, run the `dropbox_uploader.sh` script and follow the on-screen instructions to connect it to your Dropbox account:\r\n```bash\r\n$ ./dropbox_uploader.sh\r\n```\r\n\r\n## MySQL DB Backup Usage\r\n\r\nMake sure the MySQL Client is installed for your version of MySQL Server:\r\n\r\n```bash\r\n$ sudo apt-get update\r\n$ sudo apt-get install mysql-client-5.6\t# replace 5.6 with your version of MySQL\r\n```\r\n\r\nUse the `mysql_config_editor` (new in v5.6.6) to store the database login credentials in an encrypted format:\r\n\r\n```bash\r\n$ mysql_config_editor set --login-path=loginPathName --host=hostname --user=username --password\r\n```\r\n\r\nReplace `loginPathName` with a custom name and replace `hostname` and `username` with your login credentials. You will be prompted to enter your password.\r\n\r\nSome useful `mysql_config_editor` commands are:\r\n\r\n```bash\r\n$ mysql_config_editor print --all\t# to view the stored login credentials (passwords are displayed as *****)\r\n$ mysql_config_editor remove --login-path=loginPathName\t# to remove a stored login\r\n```\r\n\r\nThe `loginPathName` name is used when backing up MySQL databases. The syntax is:\r\n\r\n```bash\r\n$ ~/DropboxBackup/db_backup.sh -l loginPathName -d dbName\r\n```\r\n\r\nThis script will create a MySQL dump file, which is then compressed into a `.tar.gz` file and then uploaded to your dropbox folder.\r\n\r\n## Backup Log File\r\n\r\nEvery time the `db_backup.sh` script is executed, entries are added to `~/tmp/backup.log`. This log file can be backed up to dropbox by executing the `log_backup.sh` script as follows:\r\n\r\n```bash\r\n$ ~/DropboxBackup/log_backup.sh\r\n```\r\n\r\nAlternatively, the log file can be backed up manually by doing the following:\r\n```bash\r\n$ cd ~/tmp\r\n$ BKP_LOG_FILE=\"log-backup-$(date +\"%Y-%m-%d_%H-%M-%S\").tar.gz\"\r\n$ tar -zcf \"$BKP_LOG_FILE\" \"backup.log\"\r\n$ ~/DropboxBackup/dropbox_uploader.sh -f ~/.dropbox_uploader upload $BKP_LOG_FILE \"/Log_Backups/$BKP_LOG_FILE\"\r\n$ rm -f $BKP_LOG_FILE\r\n```\r\n\r\nThe above commands perform the following:\r\n\r\n1. Change to the `tmp` directory.\r\n2. Create a new name for the backup.\r\n3. Compress the existing log file into a `.tar.gz`.\r\n4. Upload the compressed file to dropbox.\r\n5. Delete the archive.\r\n\r\n## Scheduled Jobs (cron)\r\n\r\nCron is used on Linux to schedule commands or scripts that need to be executed periodically.\r\n\r\nTo edit your `crontab` file use:\r\n```bash\r\n$ crontab -e\r\n```\r\n\r\nProviding your system is setup to send emails (see [Sending Email using Mandrill](#6)), then add these lines to your `crontab` file to email errors to the `MAILTO` address:\r\n```\r\nMAILTO=\"<your@email.com>\"\r\n@daily ~/DropboxBackup/db_backup.sh -l loginPathName -d dbName > /dev/null\r\n30 0 * * 1 ~/DropboxBackup/log_backup.sh > /dev/null\r\n```\r\n\r\nThis cron schedule will execute the `db_backup.sh` script every day at midnight and the `log_backup.sh` script every Monday at 00:30hrs.\r\n\r\n> Note: To limit the space consumed on Dropbox, backups are automatically deleted after 28 days.\r\n\r\nTo list the cron history use:\r\n```bash\r\n$ grep CRON /var/log/syslog\r\n```\r\n\r\n### Crontab Syntax\r\n\r\nThe syntax for adding a new cron job is:\r\n```\r\n1 2 3 4 5 /path/to/command arg1 arg2\r\n```\r\n\r\nWhere:\r\n\r\n1. = Minute (0-59)\r\n2. = Hours (0-23)\r\n3. = Day (0-31)\r\n4. = Month (0-12 [12 == December])\r\n5. = Day of the week (0-7 [7 or 0 == sunday])\r\n\r\nThe syntax can also be expressed as this:\r\n\r\n```\r\n* * * * * command to be executed\r\n- - - - -\r\n| | | | |\r\n| | | | ----- Day of week (0 - 7) (Sunday == 0 or 7)\r\n| | | ------- Month (1 - 12)\r\n| | --------- Day of month (1 - 31)\r\n| ----------- Hour (0 - 23)\r\n------------- Minute (0 - 59)\r\n```\r\n\r\nAlternatively, a special string can be used to specify the first five fields:\r\n```\r\nSpecial string    Meaning\r\n@reboot           Run once, at start-up\r\n@yearly           Run once a year, \"0 0 1 1 *\"\r\n@annually         (same as @yearly)\r\n@monthly          Run once a month, \"0 0 1 * *\"\r\n@weekly           Run once a week, \"0 0 * * 0\"\r\n@daily            Run once a day, \"0 0 * * *\"\r\n@midnight         (same as @daily)\r\n@hourly           Run once an hour, \"0 * * * *\"\r\n```\r\n\r\n## Sending Email using Mandrill\r\n\r\nLinux can be configured to send email through [Mandrill](https://mandrill.com/) using your SMTP & API credentials. The information in this section is based on [this article from Mandrill.com](http://help.mandrill.com/entries/23060367-Can-I-configure-Postfix-to-send-through-Mandrill-).\r\n\r\n1: Install a SASL authentication package, [Postfix](http://www.postfix.org/) and mail utilities:\r\n```bash\r\n$ apt-get install -y libsasl2-modules postfix mailutils\r\n```\r\n\r\n\tDuring the Postfix setup select `Internet with smarthost`. Enter your fully qualified domain name (`FQDN`) e.g., `example.com` and the SMTP relay host `[smtp.mandrillapp.com]`.\r\n\r\n2: Then open the Postfix configuration file and change/append any lines that don't exist:\r\n```bash\r\n$ sudo nano /etc/postfix/main.cf\r\n# Make sure these settings exist (append any that don't):\r\nmyhostname = <your-domain-name> e.g., example.com\r\nrelayhost = [smtp.mandrillapp.com]\r\n# enable SASL authentication\r\nsmtp_sasl_auth_enable = yes\r\n# tell Postfix where the credentials are stored\r\nsmtp_sasl_password_maps = hash:/etc/postfix/sasl_passwd \r\nsmtp_sasl_security_options = noanonymous\r\n# use STARTTLS for encryption\r\nsmtp_use_tls = yes \r\n```\r\n\r\n3: Create an SMTP username and password file:\r\n```bash\r\n$ sudo nano /etc/postfix/sasl_passwd\r\n# Add your Mandrill username and API key\r\n[smtp.mandrillapp.com] USERNAME:API_KEY\r\n```\r\n\r\n4: Create the hash db file for Postfix and lock down access to it:\r\n```bash\r\n$ postmap /etc/postfix/sasl_passwd\r\n$ chmod 0600 /etc/postfix/sasl_passwd /etc/postfix/sasl_passwd.db\r\n```\r\n\r\n5: Restart the Postfix service:\r\n```bash\r\n$ service postfix restart\r\n```\r\n\r\n6: Finally, test the sending of email through Mandrill:\r\n```bash\r\n$ echo \"Test Email.\" | mail -s \"Hello\" -a \"FROM:YOUR_USERNAME@YOUR_DOMAIN.com\" TO_USERNAME@TO_DOMAIN.com\r\n```\r\n\r\n7: Check the mail log to make sure that the email has been sent properly:\r\n```bash\r\n$ cat /var/log/mail.log\r\n# Try and find this at the end of the file:\r\nstatus=sent (250 2.0.0 Ok)\r\n```\r\n\r\n## Web Cron (When Your Host Does Not Support Cron Tasks)\r\n\r\nIt is not always possible to run `cron` or `scheduled tasks`, such as on shared hosting or when using particular server configurations. In these situations, web applications often provide a `web cron` URL, which a host can automatically visit at a scheduled time to perform the same functions as a local cron job. The `web_cron.sh` script has been created to allow a `web cron` URL to be visited and the output downloaded to a daily log file, which is automatically backed up to Dropbox.\r\n\r\n### Web Cron Usage\r\n\r\nThe syntax for running a web cron task is:\r\n\r\n```bash\r\n$ ~/DropboxBackup/web_cron.sh -u URL -f FILENAME\r\n```\r\n\r\n> Note: `FILENAME` will automatically have the `.log` extension appended to it i.e., `archive` will become `archive.log`.\r\n\r\nThis script will visit the `URL` and download the output to a single daily log file `FILENAME-YEAR-MONTH-DAY.log`. Any previous days log file is compressed into a `.tar.gz` file and uploaded to Dropbox.\r\n\r\nThe web cron script can be executed regularly on a machine that does have cron capabilities. For example, to execute the script every hour at five minutes past the hour, add the following to your `crontab` file:\r\n```\r\n5 * * * * ~/DropboxBackup/web_cron.sh -u URL -f FILENAME > /dev/null\r\n```\r\n\r\n> Note: To limit the space consumed on Dropbox, backups are automatically deleted after 28 days.\r\n\r\n# Dropbox Uploader\r\n\r\nDropbox Uploader is a **BASH** script which can be used to upload, download, delete, list files (and more!) from **Dropbox**, an online file sharing, synchronization and backup service. \r\n\r\nIt's written in BASH scripting language and only needs **cURL**.\r\n\r\n**Why use this script?**\r\n\r\n* **Portable:** It's written in BASH scripting and only needs *cURL* (curl is a tool to transfer data from or to a server, available for all operating systems and installed by default in many linux distributions).\r\n* **Secure:** It's not required to provide your username/password to this script, because it uses the official Dropbox API for the authentication process. \r\n\r\nPlease refer to the &lt;Wiki&gt;(https://github.com/andreafabrizi/Dropbox-Uploader/wiki) for tips and additional information about this project. The Wiki is also the place where you can share your scripts and examples related to Dropbox Uploader.\r\n\r\n## Features\r\n\r\n* Cross platform\r\n* Support for the official Dropbox API\r\n* No password required or stored\r\n* Simple step-by-step configuration wizard\r\n* Simple and chunked file upload\r\n* File and recursive directory download\r\n* File and recursive directory upload\r\n* Shell wildcard expansion (only for upload)\r\n* Delete/Move/Rename/Copy/List files\r\n* Create share link\r\n\r\n## Getting started\r\n\r\nFirst, clone the repository using git (recommended):\r\n\r\n```bash\r\ngit clone https://github.com/andreafabrizi/Dropbox-Uploader/\r\n```\r\n\r\nor download the script manually using this command:\r\n\r\n```bash\r\ncurl \"https://raw.githubusercontent.com/andreafabrizi/Dropbox-Uploader/master/dropbox_uploader.sh\" -o dropbox_uploader.sh\r\n```\r\n\r\nThen give the execution permission to the script and run it:\r\n\r\n```bash\r\n $chmod +x dropbox_uploader.sh\r\n $./dropbox_uploader.sh\r\n```\r\n\r\nThe first time you run `dropbox_uploader`, you'll be guided through a wizard in order to configure access to your Dropbox. This configuration will be stored in `~/.dropbox_uploader`.\r\n\r\n### Configuration wizard\r\n\r\nThe configuration wizard is pretty self-explanatory. One thing to notice is that if you choose \"App permission\", your uploads will end up on Dropbox under an `App/<your_app_name>` folder. To have them stored in another folder, such as in `/dir/`, you'll need to give Dropbox-Uploader permission to all Dropbox files.\r\n\r\n## Usage\r\n\r\nThe syntax is quite simple:\r\n\r\n```\r\n./dropbox_uploader.sh COMMAND [PARAMETERS]...\r\n\r\n[%%]: Optional param\r\n<%%>: Required param\r\n```\r\n\r\n**Available commands:**\r\n\r\n* **upload** &lt;LOCAL_FILE/DIR ...&gt; &lt;REMOTE_FILE/DIR&gt;  \r\nUpload a local file or directory to a remote Dropbox folder.  \r\nIf the file is bigger than 150Mb the file is uploaded using small chunks (default 4Mb); \r\nin this case a . (dot) is printed for every chunk successfully uploaded and a * (star) if an error \r\noccurs (the upload is retried for a maximum of three times).\r\nOnly if the file is smaller than 150Mb, the standard upload API is used, and if the -p option is used\r\nthe default curl progress bar is displayed during the upload process.  \r\nThe local file/dir parameter supports wildcards expansion.\r\n\r\n* **download** &lt;REMOTE_FILE/DIR&gt; [LOCAL_FILE/DIR]  \r\nDownload file or directory from Dropbox to a local folder\r\n\r\n* **delete** &lt;REMOTE_FILE/DIR&gt;  \r\nRemove a remote file or directory from Dropbox\r\n\r\n* **move** &lt;REMOTE_FILE/DIR&gt; &lt;REMOTE_FILE/DIR&gt;  \r\nMove or rename a remote file or directory\r\n\r\n* **copy** &lt;REMOTE_FILE/DIR&gt; &lt;REMOTE_FILE/DIR&gt;  \r\nCopy a remote file or directory\r\n\r\n* **mkdir** &lt;REMOTE_DIR&gt;  \r\nCreate a remote directory on DropBox\r\n\r\n* **list** [REMOTE_DIR]  \r\nList the contents of the remote Dropbox folder\r\n\r\n* **share** &lt;REMOTE_FILE&gt;  \r\nGet a public share link for the specified file or directory\r\n \r\n* **info**  \r\nPrint some info about your Dropbox account\r\n\r\n* **unlink**  \r\nUnlink the script from your Dropbox account\r\n\r\n\r\n**Optional arguments passed before the command:**  \r\n* **-f &lt;FILENAME&gt;**  \r\nLoad the configuration file from a specific file\r\n\r\n* **-s**  \r\nSkip already existing files when download/upload. Default: Overwrite\r\n\r\n* **-d**  \r\nEnable DEBUG mode\r\n\r\n* **-q**  \r\nQuiet mode. Don't show progress meter or messages\r\n\r\n* **-p**  \r\nShow cURL progress meter\r\n\r\n* **-k**  \r\nDoesn't check for SSL certificates (insecure)\r\n\r\n\r\n**Examples:**\r\n```bash\r\n    ./dropbox_uploader.sh upload /etc/passwd /myfiles/passwd.old\r\n    ./dropbox_uploader.sh upload *.zip /\r\n    ./dropbox_uploader.sh -p download /backup.zip\r\n    ./dropbox_uploader.sh delete /backup.zip\r\n    ./dropbox_uploader.sh mkdir /myDir/\r\n    ./dropbox_uploader.sh upload \"My File.txt\" \"My File 2.txt\"\r\n    ./dropbox_uploader.sh share \"My File.txt\"\r\n    ./dropbox_uploader.sh list\r\n```\r\n\r\n## Tested Environments\r\n\r\n* GNU Linux\r\n* FreeBSD 8.3/10.0\r\n* MacOSX\r\n* Windows/Cygwin\r\n* Raspberry Pi\r\n* QNAP\r\n* iOS\r\n* OpenWRT\r\n* Chrome OS\r\n* OpenBSD\r\n\r\nIf you have successfully tested this script on others systems or platforms please let me know!\r\n\r\n## Running as cron job\r\nDropbox Uploader relies on a different configuration file for each system user. The default configuration file location is HOME_DIRECTORY/.dropbox_uploader. This means that if you do the setup with your user and then you try to run a cron job as root, it won't works.  \r\nSo, when running this script using cron, please keep in mind the following:\r\n* Remember to setup the script with the user used to run the cron job\r\n* Use always the -f option to specify the full configuration file path, because sometimes in the cron environment the home folder path is not detected correctly\r\n* My advice is, for security reasons, to not share the same configuration file with different users\r\n\r\n## How to setup a proxy\r\n\r\nTo use a proxy server, just set the **https_proxy** environment variable:\r\n\r\n**Linux:**\r\n```bash\r\n    export HTTP_PROXY_USER=XXXX\r\n    export HTTP_PROXY_PASSWORD=YYYY\r\n    export https_proxy=http://192.168.0.1:8080\r\n```\r\n\r\n**BSD:**\r\n```bash\r\n    setenv HTTP_PROXY_USER XXXX\r\n    setenv HTTP_PROXY_PASSWORD YYYY\r\n    setenv https_proxy http://192.168.0.1:8080\r\n```\r\n   \r\n## BASH and Curl installation\r\n\r\n**Debian & Ubuntu Linux:**\r\n```bash\r\n    sudo apt-get install bash (Probably BASH is already installed on your system)\r\n    sudo apt-get install curl\r\n```\r\n\r\n**BSD:**\r\n```bash\r\n    cd /usr/ports/shells/bash && make install clean\r\n    cd /usr/ports/ftp/curl && make install clean\r\n```\r\n\r\n**Cygwin:**  \r\nYou need to install these packages:  \r\n* curl\r\n* ca-certificates\r\n* dos2unix\r\n\r\nBefore running the script, you need to convert it using the dos2unix command.\r\n\r\n\r\n**Build cURL from source:**\r\n* Download the source tarball from http://curl.haxx.se/download.html\r\n* Follow the INSTALL instructions\r\n\r\n## DropShell\r\n\r\nDropShell is an interactive DropBox shell, based on DropBox Uploader:\r\n\r\n```bash\r\nDropShell v0.2\r\nThe Intractive Dropbox SHELL\r\nAndrea Fabrizi - andrea.fabrizi@gmail.com\r\n\r\nType help for the list of the available commands.\r\n\r\nandrea@Dropbox:/$ ls\r\n [D] 0       Apps\r\n [D] 0       Camera Uploads\r\n [D] 0       Public\r\n [D] 0       scripts\r\n [D] 0       Security\r\n [F] 105843  notes.txt\r\nandrea@DropBox:/ServerBackup$ get notes.txt\r\n```\r\n\r\n## Donations\r\n\r\n If you want to support this project, please consider donating:\r\n * PayPal: andrea.fabrizi@gmail.com\r\n * BTC: 1JHCGAMpKqUwBjcT3Kno9Wd5z16K6WKPqG\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}